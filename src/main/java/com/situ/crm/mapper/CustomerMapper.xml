<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.situ.crm.mapper.CustomerMapper">
	<resultMap id="BaseResultMap" type="com.situ.crm.bean.Customer">
		<constructor>
			<idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer" />
			<arg column="num" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="name" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="region" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="manager_name" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="level" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="satisfy" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="credit" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="address" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="post_code" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="phone" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="fax" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="web_site" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="licence_no" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="legal_person" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="bankroll" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="turnover" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="bank_name" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="bank_account" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="local_tax_no" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="national_tax_no" jdbcType="VARCHAR" javaType="java.lang.String" />
			<arg column="status" jdbcType="INTEGER" javaType="java.lang.Integer" />
		</constructor>
	</resultMap>
	<sql id="Base_Column_List">
		id, num, name, region, manager_name, level, satisfy,
		credit, address,
		post_code,
		phone, fax, web_site, licence_no,
		legal_person, bankroll, turnover,
		bank_name, bank_account,
		local_tax_no, national_tax_no, status
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from customer
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from
		customer
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.situ.crm.bean.Customer">
		insert into customer (id, num,
		name,
		region, manager_name, level,
		satisfy, credit, address,
		post_code,
		phone, fax,
		web_site, licence_no, legal_person,
		bankroll, turnover,
		bank_name,
		bank_account, local_tax_no, national_tax_no,
		status)
		values
		(#{id,jdbcType=INTEGER}, #{num,jdbcType=VARCHAR},
		#{name,jdbcType=VARCHAR},
		#{region,jdbcType=VARCHAR},
		#{managerName,jdbcType=VARCHAR}, #{level,jdbcType=VARCHAR},
		#{satisfy,jdbcType=VARCHAR}, #{credit,jdbcType=VARCHAR},
		#{address,jdbcType=VARCHAR},
		#{postCode,jdbcType=VARCHAR},
		#{phone,jdbcType=VARCHAR}, #{fax,jdbcType=VARCHAR},
		#{webSite,jdbcType=VARCHAR}, #{licenceNo,jdbcType=VARCHAR},
		#{legalPerson,jdbcType=VARCHAR},
		#{bankroll,jdbcType=VARCHAR},
		#{turnover,jdbcType=VARCHAR}, #{bankName,jdbcType=VARCHAR},
		#{bankAccount,jdbcType=VARCHAR}, #{localTaxNo,jdbcType=VARCHAR},
		#{nationalTaxNo,jdbcType=VARCHAR},
		#{status,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.situ.crm.bean.Customer">
		insert into customer
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="num != null">
				num,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="region != null">
				region,
			</if>
			<if test="managerName != null">
				manager_name,
			</if>
			<if test="level != null">
				level,
			</if>
			<if test="satisfy != null">
				satisfy,
			</if>
			<if test="credit != null">
				credit,
			</if>
			<if test="address != null">
				address,
			</if>
			<if test="postCode != null">
				post_code,
			</if>
			<if test="phone != null">
				phone,
			</if>
			<if test="fax != null">
				fax,
			</if>
			<if test="webSite != null">
				web_site,
			</if>
			<if test="licenceNo != null">
				licence_no,
			</if>
			<if test="legalPerson != null">
				legal_person,
			</if>
			<if test="bankroll != null">
				bankroll,
			</if>
			<if test="turnover != null">
				turnover,
			</if>
			<if test="bankName != null">
				bank_name,
			</if>
			<if test="bankAccount != null">
				bank_account,
			</if>
			<if test="localTaxNo != null">
				local_tax_no,
			</if>
			<if test="nationalTaxNo != null">
				national_tax_no,
			</if>
			<if test="status != null">
				status,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="num != null">
				#{num,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="region != null">
				#{region,jdbcType=VARCHAR},
			</if>
			<if test="managerName != null">
				#{managerName,jdbcType=VARCHAR},
			</if>
			<if test="level != null">
				#{level,jdbcType=VARCHAR},
			</if>
			<if test="satisfy != null">
				#{satisfy,jdbcType=VARCHAR},
			</if>
			<if test="credit != null">
				#{credit,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				#{address,jdbcType=VARCHAR},
			</if>
			<if test="postCode != null">
				#{postCode,jdbcType=VARCHAR},
			</if>
			<if test="phone != null">
				#{phone,jdbcType=VARCHAR},
			</if>
			<if test="fax != null">
				#{fax,jdbcType=VARCHAR},
			</if>
			<if test="webSite != null">
				#{webSite,jdbcType=VARCHAR},
			</if>
			<if test="licenceNo != null">
				#{licenceNo,jdbcType=VARCHAR},
			</if>
			<if test="legalPerson != null">
				#{legalPerson,jdbcType=VARCHAR},
			</if>
			<if test="bankroll != null">
				#{bankroll,jdbcType=VARCHAR},
			</if>
			<if test="turnover != null">
				#{turnover,jdbcType=VARCHAR},
			</if>
			<if test="bankName != null">
				#{bankName,jdbcType=VARCHAR},
			</if>
			<if test="bankAccount != null">
				#{bankAccount,jdbcType=VARCHAR},
			</if>
			<if test="localTaxNo != null">
				#{localTaxNo,jdbcType=VARCHAR},
			</if>
			<if test="nationalTaxNo != null">
				#{nationalTaxNo,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.situ.crm.bean.Customer">
		update customer
		<set>
			<if test="num != null">
				num = #{num,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="region != null">
				region = #{region,jdbcType=VARCHAR},
			</if>
			<if test="managerName != null">
				manager_name = #{managerName,jdbcType=VARCHAR},
			</if>
			<if test="level != null">
				level = #{level,jdbcType=VARCHAR},
			</if>
			<if test="satisfy != null">
				satisfy = #{satisfy,jdbcType=VARCHAR},
			</if>
			<if test="credit != null">
				credit = #{credit,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="postCode != null">
				post_code = #{postCode,jdbcType=VARCHAR},
			</if>
			<if test="phone != null">
				phone = #{phone,jdbcType=VARCHAR},
			</if>
			<if test="fax != null">
				fax = #{fax,jdbcType=VARCHAR},
			</if>
			<if test="webSite != null">
				web_site = #{webSite,jdbcType=VARCHAR},
			</if>
			<if test="licenceNo != null">
				licence_no = #{licenceNo,jdbcType=VARCHAR},
			</if>
			<if test="legalPerson != null">
				legal_person = #{legalPerson,jdbcType=VARCHAR},
			</if>
			<if test="bankroll != null">
				bankroll = #{bankroll,jdbcType=VARCHAR},
			</if>
			<if test="turnover != null">
				turnover = #{turnover,jdbcType=VARCHAR},
			</if>
			<if test="bankName != null">
				bank_name = #{bankName,jdbcType=VARCHAR},
			</if>
			<if test="bankAccount != null">
				bank_account = #{bankAccount,jdbcType=VARCHAR},
			</if>
			<if test="localTaxNo != null">
				local_tax_no = #{localTaxNo,jdbcType=VARCHAR},
			</if>
			<if test="nationalTaxNo != null">
				national_tax_no = #{nationalTaxNo,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.situ.crm.bean.Customer">
		update customer
		set num = #{num,jdbcType=VARCHAR},
		name = #{name,jdbcType=VARCHAR},
		region = #{region,jdbcType=VARCHAR},
		manager_name =
		#{managerName,jdbcType=VARCHAR},
		level = #{level,jdbcType=VARCHAR},
		satisfy = #{satisfy,jdbcType=VARCHAR},
		credit =
		#{credit,jdbcType=VARCHAR},
		address = #{address,jdbcType=VARCHAR},
		post_code = #{postCode,jdbcType=VARCHAR},
		phone =
		#{phone,jdbcType=VARCHAR},
		fax = #{fax,jdbcType=VARCHAR},
		web_site =
		#{webSite,jdbcType=VARCHAR},
		licence_no =
		#{licenceNo,jdbcType=VARCHAR},
		legal_person =
		#{legalPerson,jdbcType=VARCHAR},
		bankroll =
		#{bankroll,jdbcType=VARCHAR},
		turnover = #{turnover,jdbcType=VARCHAR},
		bank_name = #{bankName,jdbcType=VARCHAR},
		bank_account =
		#{bankAccount,jdbcType=VARCHAR},
		local_tax_no =
		#{localTaxNo,jdbcType=VARCHAR},
		national_tax_no =
		#{nationalTaxNo,jdbcType=VARCHAR},
		status = #{status,jdbcType=INTEGER}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="pageList" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from customer
	</select>
	<select id="getSatisfy" resultType="string">
		select DISTINCT satisfy from
		customer order by satisfy
	</select>
	<select id="getCredit" resultType="string">
		select DISTINCT credit from
		customer order by credit
	</select>
	<select id="getLevel" resultType="string">
		select DISTINCT level from
		customer order by level
	</select>
	<select id="getManagerName" resultType="string">
		select DISTINCT
		manager_name from customer
	</select>
	<select id="getRegion" resultType="string">
		select DISTINCT region from
		customer
	</select>

	<delete id="doDelete">
		delete from customer
		<where>
			id in
			<foreach collection="array" item="id" open="(" close=")"
				separator=",">
				#{id}
			</foreach>
		</where>
	</delete>
	<select id="selectBeingLossCustomer" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		FROM customer AS c
		WHERE id NOT IN
		(SELECT customer_id
		FROM
		customer_order
		WHERE DATE_ADD(order_date, INTERVAL 6 MONTH) > NOW())
		AND c.status=0;
	</select>
	<select id="selectAllCustomerContribution" resultType="com.situ.crm.vo.CustomerContribution">
		SELECT c.name as customerName,SUM(oi.sum) as totalPrice FROM customer AS c INNER JOIN
		customer_order AS co ON c.id=co.customer_id RIGHT JOIN order_item AS
		oi ON co.id=oi.order_id GROUP BY oi.order_id
	</select>
</mapper>